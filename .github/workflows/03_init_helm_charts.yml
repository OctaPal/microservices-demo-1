name: Init Services

on: 
  push:
    branches: [ master ]
    paths: 
      - ".github/workflows/02_init_helm_workflow.yml"
  pull_request:
    branches: [ master ]
    paths: 
      - ".github/workflows/02_init_helm_workflow.yml"

jobs:

  build:

    runs-on: ubuntu-latest
   
    steps:
    - uses: actions/checkout@v2

    - name: "Login Azure ClI"
      uses: azure/login@v1
      with:
        creds: ${{ secrets.PROJECTIN_SP }}


    - name: "Login AKS"
      uses: azure/aks-set-context@v1
      with:
        creds: ${{ secrets.PROJECTIN_SP }} # Azure credentials
        resource-group: 'rg-hipster-dev-eastus'
        cluster-name: 'aks-hipster-dev-eastus'
      id: login   
    
    - name: 'Install helm'
      uses: azure/setup-helm@v1
      with:
        version: latest # default is latest stable
      id: install

    - name: Helm install hipsterstore chart
      run: | 
          helm install hipsterstore ./helmHipster
